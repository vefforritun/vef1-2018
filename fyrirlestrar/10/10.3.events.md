---
title: Fyrirlestur 10.3 ‚Äì Atbur√∞ir
---

# Fyrirlestur 10.3 ‚Äì Atbur√∞ir

## Vefforritun 1 ‚Äî T√ñL107G

### √ìlafur Sverrir Kjartansson, [osk@hi.is](mailto:osk@hi.is)

---

## Forrit sem breg√∞ast vi√∞ atbur√∞um

* √ûegar vi√∞ skrifum fl√≥knari forrit t√∂kum vi√∞ yfirleitt vi√∞ skipunum e√∞a g√∂gnum fr√° notendum
* Hvernig getur forriti√∞ okkar vita√∞ √æegar slegi√∞ er √° takka e√∞a √Ωtt √° m√∫sarhnapp?
  - S√≠fellt a√∞ athuga hvort b√∫i√∞ s√© a√∞ hreyfa m√∫s e√∞a smella √° takka? üò´

***

* Notum _atbur√∞i_ (events) til a√∞ breg√∞ast vi√∞ hlutum sem gerast √° einhverjum t√≠mapunkti √≠ framt√≠√∞inni
* Atbur√∞ir gerast √≥samstillt‚Äîeru async!

***

## Atbur√∞ir ‚Äì events

* Getum fylgst me√∞ atbur√∞um...
  - sem vafrinn veldur
  - sem notandi veldur
* Skr√°um √æ√°tt√∂ku me√∞ `addEventListener` falli √° n√≥√∞um

***

```javascript
window.addEventListener('click', () => {
  console.log('You knocked?');
});
```

***

## Taka √æ√°tt √≠ atbur√∞um

* Skr√°um a√∞ vi√∞ viljum me√∞h√∂ndla vissa tegund af atbur√∞ √° √°kve√∞num n√≥√∞um
* √ûegar atbur√∞ur gerist eru allir √æeir sem skr√°√∞ sig hafa l√°tnir vita √≠ (flestum tilfellum) FIFO (first‚Äìin, first‚Äìout) r√∂√∞
* A√∞eins ein me√∞h√∂ndlun √° s√©r sta√∞ √≠ einu

***

## Skr√° me√∞h√∂ndlun

* Skr√°um me√∞h√∂ndlun √° n√≥√∞u me√∞ fallinu `element.addEventListener(name, listener)`
  - `name` er nafn √° atbur√∞
  - `listener` er **fall sem keyrir vi√∞ atbur√∞**

***

* Afskr√°um me√∞h√∂ndlun me√∞ `element.removeEventListener(name, listener)`
  - √ûurfum a√∞ vita _hva√∞a_ fall √° a√∞ fjarl√¶gja

***

* Ef vi√∞ skr√°um nefnd f√∂ll e√∞a breytur sem innihalda fall sem gildi megum vi√∞ ekki keyra falli√∞ √æegar vi√∞ b√¶tum √æv√≠ vi√∞
  - `element.addEventListener('click', fn)`
  - **Ekki** `element.addEventListener('click', fn())`

***

```html
<button>Click me</button>
```

<!-- eslint-disable operator-linebreak -->

```javascript
const button =
  document.querySelector('button');
button.addEventListener('click', () => {
  console.log('Button clicked.');
});
button.addEventListener('click', () => {
  console.log('You knocked?');
});
```

```javascript
// smellt √° takka
// "Button clicked."
// "You knocked?"
```

***

```html
<button>Click me</button>
```

<!-- eslint-disable operator-linebreak -->

```javascript
const button =
  document.querySelector('button');

function once() {
  console.log('√ûetta keyrir einu sinni.');
  button.removeEventListener('click', once);
}
button.addEventListener('click', once);
```

***

[D√¶mi](daemi/events/button.html)

***

## Uppl√Ωsingar um atbur√∞

* F√°um hlut me√∞ uppl√Ωsingum um atbur√∞ sem argument √≠ fall
  - Oftast kalla√∞ `e` e√∞a `event`
* Uppl√Ωsingar eru t.d. um hva√∞a lykil var slegi√∞ √° lyklabor√∞, e√∞a hva√∞a takka √° m√∫s

***

## Atbur√∞ir flj√≥ta upp

* Atbur√∞ir flj√≥ta upp DOM tr√©√∞ og byrja √° innsta elementi sem tekur vi√∞ atbur√∞
* Ef smellt √° takka innan `<div>`sem b√¶√∞i hafa `click` handler f√¶r takki fyrst a√∞ keyra, s√≠√∞an `<div>`

***

* `target` √° uppl√Ωsingahlut segir til um hvert innsta elementi√∞ var
* `stopPropagation()` √° uppl√Ωsingahlut stoppar a√∞ atbur√∞ur flj√≥ti upp

***

## Sj√°lfgefin heg√∞un

* Sumir atbur√∞ir valda sj√°lfgefinni heg√∞un
  - `<a href>` mun senda okkur √æanga√∞ sem `href` bendir
  - A√∞ √Ωta √° ni√∞ur √∂r mun skruna s√≠√∞u ni√∞ur
* `preventDefault()` √° uppl√Ωsingahlut stoppar sj√°lfgefna heg√∞un

***

## Lyklabor√∞

* √ûegar vi√∞ smellum √° lyklabor√∞ f√°um vi√∞ uppl√Ωsingar um hva√∞a lykil var slegi√∞ √°
  - `e.keyCode` segir til um k√≥√∞a fyrir staf, t.d. `65` fyrir `a` (sama fyrir st√≥ra `A`!)
  - `e.key` segir til um stafinn, √æ√° `a` e√∞a `A`

***

## A√∞rir atbur√∞ir

* `scroll` atbur√∞ur √° s√©r sta√∞ √æegar element er skrolla√∞
  - `scroll` √° `window` heldur utanum skroll √° s√≠√∞u
* `mousemove` atbur√∞ur √° s√©r sta√∞ ef m√∫sinn er hreyf√∞
  - Getum √∫tf√¶rt drag'n'drop me√∞ √æv√≠

***

* `touchstart`, `touchmove` og `touchend` atbur√∞ir gerast √æegar vefurinn er _snertur_
* Og fleiri vi√∞bur√∞ir...

***

## Hven√¶r keyrir JavaScript?

* √ûar sem JavaScript er keyrt um lei√∞ og √æ√°ttun l√≠kur getur veri√∞ a√∞ DOM s√© ekki tilb√∫i√∞
* Getum fest okkur √° atbur√∞ sem segir okkur til um a√∞ DOM s√© tilb√∫i√∞
  - `document.addEventListener( 'DOMContentLoaded', fn);`
* Skiptir ekki m√°li √æ√° hvort `<script>` s√© ne√∞st √≠ `<body>`

***

[D√¶mi um uppl√Ωsingahlut](daemi/events/event.html)

[D√¶mi um skrun](daemi/events/scroll.html)

[D√¶mi um DOMLoaded](daemi/events/domloaded.html)

***

## Debouncing

* Stundum viljum vi√∞ gera eitthva√∞ vi√∞ atbur√∞ sem gerist mj√∂g oft
  - Vi√∞ hreyfingu √° m√∫s
  - Skrif √° lyklabor√∞
  - Vi√∞ skroll √° s√≠√∞u
* √ì√æarfi a√∞ gera fyrir _hvert tilvik atbur√∞ar_, n√≥g a√∞ gera eftir e√∞a √° √°kve√∞num fresti

***

<!-- eslint-disable operator-linebreak -->

```javascript
const textarea =
  document.querySelector('textarea');

let timeout;

textarea.addEventListener('keydown', () => {
  clearTimeout(timeout);
  timeout = setTimeout(() => {
    console.log('You stopped typing.');
  }, 500);
});
```

***

[D√¶mi](daemi/events/debounce.html)

---

## DOM og form

* Vi√∞ vinnum miki√∞ me√∞ `<form>` √≠ vefforritun, oft viljum vi√∞ gera eitthva√∞ √≠ sta√∞inn fyrir a√∞ senda √æau
* [`FormData` API](https://developer.mozilla.org/en-US/docs/Web/API/FormData) leyfir okkur a√∞ f√° _√∂ll_ g√∂gn √∫r formi √≠ hlut til a√∞ vinna me√∞
* Notum `submit` event √° forminu sj√°lfu til a√∞ taka m√°lin √≠ okkar hendur me√∞ `preventDefault()`

***

<!-- eslint-disable no-undef, no-unused-vars -->

```javascript
form.addEventListener('submit', (e) => {
  e.preventDefault();
  const data = new FormData(form);
});
```

***

## input og textarea

* H√¶gt a√∞ eiga vi√∞ `input` og `textarea` reiti me√∞ √æv√≠ a√∞ nota `focus` og `blur` atbur√∞i
* Getum √°tt vi√∞ textann sj√°lfan me√∞ [selection](https://developer.mozilla.org/en-US/docs/Web/API/Selection) API
* Ef vi√∞ viljum breg√∞ast vi√∞ √æv√≠ a√∞ eitthva√∞ s√© √°tt vi√∞ textareiti er best a√∞ nota `input` atbur√∞ √≠ sta√∞inn fyrir `mouseup` e√∞a √°l√≠ka

***

## checkbox, radio og select

* Getum fylgst me√∞ breytingum √° `checkbox`, `radio` og `select` me√∞ `change` atbur√∞inum
* `checkbox` hafa `checked` eigindi sem segja til um st√∂√∞u √æeirra

***

* `radio` hefur `value` sem gefur hva√∞a gildi s√∫ breyta sem skilgreind er me√∞ `name` attribute hefur
* `select` hefur `value` sem segir til um hva√∞ er vali√∞, en getur √æ√≥ or√∞i√∞ fl√≥knara

***

[D√¶mi](daemi/events/form.html)
